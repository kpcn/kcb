---
import PageLayout from '@layouts/Page.astro';
import PostItem from '@components/PostItem.astro';
import { kebabCase } from '@utils/format';

import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');

  const tags = Array.from(
    new Set(
      blogEntries
        .map((entry) => {
          return entry.data.tags;
        })
        .flat()
    )
  );

  return tags.map((val) => {
    return {
      params: {
        tag: `tags/${kebabCase(val || '')}`,
      },
      props: {
        name: val,
      },
    };
  });
}

const { tag } = Astro.params;
const postsByTag = await getCollection('blog', (posts) => {
  return posts?.data?.tags?.some(
    (val) => `tags/${kebabCase(val || '')}` === tag
  );
});
---

<PageLayout metaData={{}}>
  <div
    class="flex flex-col space-y-4 bg-white px-3 py-4 dark:bg-slate-600 md:px-6"
  >
    {postsByTag.map((post) => <PostItem post={post} />)}
  </div>
</PageLayout>
